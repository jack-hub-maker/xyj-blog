## 理解 JavaScript 纯函数

函数式编程中有一个非常重要的概念叫纯函数，JavaScript 符合函数式编程的范式，所以也有纯函数的概念；

- 在 react 开发中纯函数是被多次提及的；
- 比如 react 中组件就被要求像是一个纯函数（为什么是像，因为还有 class 组件），redux 中有一个 reducer 的概念，也
  是要求必须是一个纯函数；
- 所以掌握纯函数对于理解很多框架的设计是非常有帮助的；

纯函数的维基百科定义：

- 在程序设计中，若一个函数`符合以下条件`，那么这个函数被称为纯函数：
- 此函数`在相同的输入值时`，需`产生相同的输出`。
- 函数的`输出和输入值以外的其他隐藏信息或状态无关`，也和`由I/O设备产生的外部输出`无关。
- 该函数`不能有语义上可观察的函数副作用`，诸如“`触发事件`”，`使输出设备输出，或更改输出值以外物件的内容`等。

当然上面的定义会过于的晦涩，所以我简单总结一下：

- `确定的输入，一定会产生确定的输出`；
- `函数在执行过程中，不能产生副作用`;

## 副作用的理解

那么这里又有一个概念，叫做副作用，什么又是副作用呢？

- 副作用（side effect）其实本身是医学的一个概念，比如我们经常说吃什么药本来是为了治病，可能会产生一
  些其他的副作用；
- 在计算机科学中，也引用了副作用的概念，表示`在执行一个函数`时，除了`返回函数值`之外，还对`调用函数产生了附加的影响`，比如`修改了全局变量`，`修改参数或者改变外部的存储`；

纯函数在执行的过程中就是不能产生这样的副作用：副作用往往是产生`bug的 “温床”`。

!>其实无论是 vue3 和 react 越来越趋向于函数式编程，无论是 vue 中的单向数据流还是 react 中的纯函数其实都是一个概念，所以理解学习纯函数是非常重要的

> [!tip]
> 但是我们不能保证我们所编写的函数都是纯函数，比如有些时候我们的初衷就是想要改变全局的一个东西，这其实是无法避免的，所以我们应该尽量编写纯函数

## 纯函数的案例

我们来看一个对数组操作的两个函数：

- slice：slice 截取数组时不会对原数组进行任何操作,而是生成一个新的数组；
- splice：splice 截取数组, 会返回一个新的数组, 也会对原数组进行修改；
- slice 就是一个纯函数，不会修改传入的参数；

所以当我们想有这种的需求的时候，有这两种方案，我们应该尽量使用 slice

```js
var names = ["tao", "sandy", "zm", "ymy"];

// slice截取，会返回一个新的数组，但是不会对原数组进行修改
var newNames = names.slice(0, 2);
console.log(newNames);
console.log(names);

// splice截取数组，会返回一个新的数组，也会对原数组进行修改
var newNames2 = names.splice(0, 2);
console.log(newNames2);
console.log(names);
```

下面我们来看几个案例

```js
// 这个很明显就是一个纯函数
function sum(num1, num2) {
  return num1 + num2;
}
```

```js
// 这个显然不是纯函数
// 相同的输入没有产生相同的输出
var age = 5;

function add(num) {
  return age + num;
}

console.log(add(5));
age = 10;
console.log(add(5));
```

```js
// 这个函数不是一个纯函数
// 虽然相同的输入，会有相同的输出
// 但是函数修改了参数，产生了副作用
var info = {
  name: "tao",
  age: 19,
};

function foo(info) {
  info.name = "sandy";
}

foo(info);
```

```js
// 这个其实在社区还有很多争论的
// 函数的输出与外部的环境无关
// console.log是不是也算输出
// 输出了外部的age
// 这个问题我的看法是：从严格的角度来说这个函数不是一个纯函数
// 但是如果是我的话，我会觉得这个是一个纯函数，我只是打印了外部的age看一下，并没有产生任何的副作用
var age = 19;
function foo() {
  console.log(age);
}
```

## 纯函数的优势

为什么纯函数在函数式编程中非常重要呢？

- 因为你可以`安心的编写`和`安心的使用`；
- 你在`写的时候`保证了函数的纯度，只是`单纯实现自己的业务逻辑`即可，`不需要关心传入的内容`是如何获得的或
  者`依赖其他的外部变量`是否已经发生了修改；
- 你在`用的时候`，你确定`你的输入内容不会被任意篡改`，并且`自己确定的输入`，一定会`有确定的输出`；

React 官方就要求我们无论是函数还是 class 声明一个组件，这个组件都必须像纯函数一样，保护它们的 props 不被修
改：


